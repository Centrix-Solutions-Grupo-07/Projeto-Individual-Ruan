<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/favicon.ico">
    <title>Dashboard | Ruan</title>
    <link rel="stylesheet" href="css/dashboard-ruan.css">
    <link rel="stylesheet" href="css/barra-lateral.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
    <div class="container_principal">
        <div class="barra_lateral" id="lateral_barra"></div>
        <div class="area_dash">
            <div class="dash_superior">
                <div class="bem_vindo">
                    <span class="text_bemVindo1">
                        Bem-vindo
                    </span>
                    <span class="text_bemVindo2">
                        Calcule se as configurações do seu computador são ideais para trabalhar em um call center.
                    </span>
                </div>
            </div>
            <div class="card_monitoramento">
                <div class="area_meio">
                    <div class="area_meio_esquerda">
                        <div class="painel">
                            <div id="popup" class="popup">
                                <span class="close" onclick="fecharPopup()">&times;</span>
                                <p>CPU: Um processador com pelo menos 4 núcleos é uma boa escolha para lidar com
                                    multitarefas. Processadores mais potentes podem ser necessários se houver
                                    aplicativos mais exigentes em uso.</p>
                                <p>RAM: Recomenda-se ter pelo menos 8 GB de RAM para garantir que o sistema possa
                                    executar várias aplicações simultaneamente sem diminuir o desempenho.</p>
                                <p>Disco: Um disco rígido de 500 GB ou maior pode ser adequado para armazenamento de
                                    dados.</p>
                                <p>O gráfico de progresso exibido compara a eficiência da máquina do usuário com uma
                                    máquina ideal em um ambiente de call center. A métrica de desempenho avaliada é a
                                    capacidade de gerenciamento de chamadas e interações com os clientes. A linha do
                                    usuário representa a performance da máquina específica em termos de tempo de
                                    resposta, precisão nas respostas e eficácia na resolução de problemas.</p>
                            </div>
                            <div class="area_barra">
                                <div class="h3-progress">
                                    <h3>Qualidade da CPU: </h3>
                                    <h3 class="h3-margin" id="cpu"></h3>
                                </div>
                                <progress class="barra_painel" max="4" value="2" id="barra_cpu"></progress>
                            </div>
                            <div class="area_barra">
                                <div class="h3-progress">
                                    <h3 clas>Qualidade da RAM: </h3>
                                    <h3 class="h3-margin" id="ram"></h3>
                                </div>

                                <progress class="barra_painel" max="8" value="4" id="barra_ram"></progress>
                            </div>
                            <div class="area_barra">
                                <div class="h3-progress">
                                    <h3>Qualidade do Disco: </h3>
                                    <h3 class="h3-margin" id="disco"></h3>
                                </div>

                                <progress class="barra_painel" max="500" value="250" id="barra_disco"></progress>
                            </div>
                        </div>
                    </div>
                    <div class="area_meio_direita">
                        <div class="calculadora">
                            <h1>Calculadora de Recursos</h1>
                            <div class="botao_row">
                                <button class="botao-calculadora" onclick="calcular()">Calcular</button>
                                <div class="botao-popup">
                                    <button onclick="abrirPopup()"><img src="assets/informacao.png"
                                            alt="Informação"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="area_inferior">
                    <div class="area_inferior_direita">
                        <div class="botao-grafico">
                            <h1>Estilos de Gráficos</h1>
                            <button onclick="alterarTipoGrafico('line')">Gráfico de Linha</button>
                            <button onclick="alterarTipoGrafico('scatter')">Gráfico de Dispersão</button>
                            <button onclick="alterarTipoGrafico('bar')">Gráfico de Barras</button>
                            <button onclick="alterarTipoGrafico('radar')">Gráfico de Radar</button>
                        </div>
                    </div>
                    <div class="area_inferior_esquerda">
                        <div class="grafico">
                            <canvas id="graficoTempoReal" width="300px"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    // Função para fazer solicitação AJAX e obter os dados do servidor
    function calcular() {
        fetch('http://localhost:3333/dashboard/calcular')
            .then(response => response.json())
            .then(data => {
                // Destruturação dos dados obtidos
                const { CPU, RAM, DISCO } = data;

                // Salvando os resultados no sessionStorage
                sessionStorage.setItem('CPU', CPU);
                sessionStorage.setItem('RAM', RAM);
                sessionStorage.setItem('DISCO', DISCO);

                // Atualizando os elementos HTML com os resultados
                const cpuDiv = document.getElementById('cpu');
                cpuDiv.textContent = ` ${CPU} Núcleos`;

                const ramDiv = document.getElementById('ram');
                ramDiv.textContent = ` ${RAM}Gb`;

                const discoDiv = document.getElementById('disco');
                discoDiv.textContent = ` ${DISCO}Gb`;

                // Atualizando as barras de progresso com os valores obtidos
                const barraCpu = document.getElementById('barra_cpu');
                barraCpu.value = CPU;

                const barraRam = document.getElementById('barra_ram');
                barraRam.value = RAM;

                const barraDisco = document.getElementById('barra_disco');
                barraDisco.value = DISCO;
            })
            .catch(error => console.error('Erro ao calcular:', error));
    }

    // Função para abrir o pop-up de informações
    function abrirPopup() {
        document.getElementById('popup').style.display = 'block';
    }

    // Função para fechar o pop-up de informações
    function fecharPopup() {
        document.getElementById('popup').style.display = 'none';
    }

    function alterarTipoGrafico(tipo) {
        // Altere o tipo do gráfico
        graficoTempoReal.config.type = tipo;

        // Atualize o gráfico
        graficoTempoReal.update();
    }

</script>

<script>

    var ctx = document.getElementById('graficoTempoReal').getContext('2d');
    var graficoTempoReal = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'CPU Percent',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 2,
                data: [],
                fill: false
            }, {
                label: 'RAM Percent',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                data: [],
                fill: false
            }, {
                label: 'DISCO Percent',
                borderColor: 'rgba(255, 205, 86, 1)',
                borderWidth: 2,
                data: [],
                fill: false
            }]
        },
        options: {
            scales: {
                y: {
                    type: 'linear',
                    position: 'bottom'
                },
                x: {
                    beginAtZero: true
                }
            }
        }
    });

    function atualizarGraficoTempoReal() {
        fetch('http://localhost:3333/dashboard/metricas_tempo_real')
            .then(response => response.json())
            .then(data => {
                if (data.cpu_percent !== null && data.ram_percent !== null && data.disco_percent !== null) {
                    // Adiciona nova entrada de tempo
                    graficoTempoReal.data.labels.push(new Date().toLocaleTimeString());

                    // Adiciona os dados ao conjunto de dados correspondente
                    graficoTempoReal.data.datasets[0].data.push(data.cpu_percent);
                    graficoTempoReal.data.datasets[1].data.push(data.ram_percent);
                    graficoTempoReal.data.datasets[2].data.push(data.disco_percent);

                    // Limita o número de entradas no gráfico para 10
                    if (graficoTempoReal.data.labels.length > 5) {
                        graficoTempoReal.data.labels.shift();
                        graficoTempoReal.data.datasets[0].data.shift();
                        graficoTempoReal.data.datasets[1].data.shift();
                        graficoTempoReal.data.datasets[2].data.shift();
                    }

                    // Atualiza o gráfico
                    graficoTempoReal.update();
                } else {
                    console.error('Valores nulos recebidos.');
                }
            })
            .catch(error => console.error('Erro ao obter dados para o gráfico:', error));
    }

    setInterval(atualizarGraficoTempoReal, 5000);

</script>

</html>